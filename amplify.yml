version: 1
frontend:
    phases:
        preBuild:
            commands:
                - nvm install 16
                - nvm use 16
                - npm cache clean --force
                - rm -rf node_modules package-lock.json
                - export NODE_OPTIONS=--openssl-legacy-provider
                - npm install --legacy-peer-deps
                - npm install --save-dev @babel/plugin-proposal-private-property-in-object@7.21.11
        build:
            commands:
                - export NODE_OPTIONS="--max_old_space_size=4096 --openssl-legacy-provider"
                - CI=false GENERATE_SOURCEMAP=false npm run build
    artifacts:
        baseDirectory: build
        files:
            - '**/*'
    cache:
        paths:
            - 'node_modules/**/*'